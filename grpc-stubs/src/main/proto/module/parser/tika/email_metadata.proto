syntax = "proto3";

package io.pipeline.parsed.data.email.v1;

import "google/protobuf/timestamp.proto";
import "google/protobuf/struct.proto";
import "module/parser/tika/tika_base_metadata.proto";

option java_multiple_files = true;
option java_package = "io.pipeline.parsed.data.email.v1";
option java_outer_classname = "EmailMetadataProto";

/**
 * Comprehensive email metadata as extracted by Tika from email files.
 * Based on Tika's Message interface, MAPI interface, TikaCoreProperties, and actual parser implementations.
 * This is a 1:1 mapping to all fields that Tika can extract from email files.
 */
message EmailMetadata {
  // === TikaCoreProperties (Core Tika metadata) ===
  optional string title = 1;                   // TikaCoreProperties.TITLE (email subject)
  optional string creator = 2;                 // TikaCoreProperties.CREATOR (from address)
  optional string description = 3;             // TikaCoreProperties.DESCRIPTION
  optional string subject = 4;                 // TikaCoreProperties.SUBJECT (conversation topic)
  optional string language = 5;                // TikaCoreProperties.LANGUAGE
  optional string publisher = 6;               // TikaCoreProperties.PUBLISHER
  optional string rights = 7;                  // TikaCoreProperties.RIGHTS
  optional string format = 8;                  // TikaCoreProperties.FORMAT
  optional string identifier = 9;              // TikaCoreProperties.IDENTIFIER
  optional string contributor = 10;            // TikaCoreProperties.CONTRIBUTOR
  optional string coverage = 11;               // TikaCoreProperties.COVERAGE
  optional string relation = 12;               // TikaCoreProperties.RELATION
  optional string source = 13;                 // TikaCoreProperties.SOURCE
  optional string type = 14;                   // TikaCoreProperties.TYPE
  optional google.protobuf.Timestamp created = 15;    // TikaCoreProperties.CREATED (message date)
  optional google.protobuf.Timestamp modified = 16;   // TikaCoreProperties.MODIFIED (last modified)
  optional string creator_tool = 17;           // TikaCoreProperties.CREATOR_TOOL
  optional string comments = 18;               // TikaCoreProperties.COMMENTS
  optional int32 rating = 19;                  // TikaCoreProperties.RATING
  
  // === Message Properties (Message interface) ===
  optional string message_from = 20;           // Metadata.MESSAGE_FROM
  optional string message_to = 21;             // Metadata.MESSAGE_TO
  optional string message_cc = 22;             // Metadata.MESSAGE_CC
  optional string message_bcc = 23;            // Metadata.MESSAGE_BCC
  repeated string message_from_name = 24;      // Message.MESSAGE_FROM_NAME
  repeated string message_from_email = 25;     // Message.MESSAGE_FROM_EMAIL
  repeated string message_to_name = 26;        // Message.MESSAGE_TO_NAME
  repeated string message_to_display_name = 27; // Message.MESSAGE_TO_DISPLAY_NAME
  repeated string message_to_email = 28;       // Message.MESSAGE_TO_EMAIL
  repeated string message_cc_name = 29;        // Message.MESSAGE_CC_NAME
  repeated string message_cc_display_name = 30; // Message.MESSAGE_CC_DISPLAY_NAME
  repeated string message_cc_email = 31;       // Message.MESSAGE_CC_EMAIL
  repeated string message_bcc_name = 32;       // Message.MESSAGE_BCC_NAME
  repeated string message_bcc_display_name = 33; // Message.MESSAGE_BCC_DISPLAY_NAME
  repeated string message_bcc_email = 34;      // Message.MESSAGE_BCC_EMAIL
  optional string multipart_subtype = 35;      // Message.MULTIPART_SUBTYPE
  optional string multipart_boundary = 36;     // Message.MULTIPART_BOUNDARY
  
  // === MAPI Properties (Microsoft Outlook/Exchange specific) ===
  optional string message_class = 37;          // MAPI.MESSAGE_CLASS (normalized)
  optional string message_class_raw = 38;      // MAPI.MESSAGE_CLASS_RAW (raw value)
  optional string sent_by_server_type = 39;    // MAPI.SENT_BY_SERVER_TYPE
  optional string from_representing_name = 40; // MAPI.FROM_REPRESENTING_NAME
  optional string from_representing_email = 41; // MAPI.FROM_REPRESENTING_EMAIL
  optional google.protobuf.Timestamp submission_accepted_at_time = 42; // MAPI.SUBMISSION_ACCEPTED_AT_TIME
  optional string submission_id = 43;          // MAPI.SUBMISSION_ID
  optional string internet_message_id = 44;    // MAPI.INTERNET_MESSAGE_ID
  repeated string internet_references = 45;    // MAPI.INTERNET_REFERENCES
  optional string conversation_topic = 46;     // MAPI.CONVERSATION_TOPIC
  optional string conversation_index = 47;     // MAPI.CONVERSATION_INDEX (hex encoded)
  optional string in_reply_to_id = 48;         // MAPI.IN_REPLY_TO_ID
  optional string recipients_string = 49;      // MAPI.RECIPIENTS_STRING
  optional int32 importance = 50;              // MAPI.IMPORTANCE
  optional int32 priority = 51;                // MAPI.PRIORTY (note: typo in Tika)
  optional bool is_flagged = 52;               // MAPI.IS_FLAGGED
  repeated string body_types_processed = 53;   // MAPI.BODY_TYPES_PROCESSED
  
  // === MAPI Attachment Properties ===
  optional string attach_long_path_name = 54;  // MAPI.ATTACH_LONG_PATH_NAME
  optional string attach_long_file_name = 55;  // MAPI.ATTACH_LONG_FILE_NAME
  optional string attach_file_name = 56;       // MAPI.ATTACH_FILE_NAME
  optional string attach_content_id = 57;      // MAPI.ATTACH_CONTENT_ID
  optional string attach_content_location = 58; // MAPI.ATTACH_CONTENT_LOCATION
  optional string attach_display_name = 59;    // MAPI.ATTACH_DISPLAY_NAME
  optional string attach_extension = 60;       // MAPI.ATTACH_EXTENSION
  optional string attach_mime = 61;            // MAPI.ATTACH_MIME
  optional string attach_language = 62;        // MAPI.ATTACH_LANGUAGE
  
  // === RTF Properties (Rich Text Format specific) ===
  optional bool contains_encapsulated_html = 63; // RTFMetadata.CONTAINS_ENCAPSULATED_HTML
  
  // === Raw Header Properties ===
  // Note: Raw headers are stored with MESSAGE_RAW_HEADER_PREFIX + header name
  // These are dynamic and parser-specific, so we include common ones
  optional string raw_header_date = 64;        // Message-Raw-Header:Date
  optional string raw_header_message_id = 65;  // Message-Raw-Header:Message-ID
  optional string raw_header_references = 66;  // Message-Raw-Header:References
  optional string raw_header_in_reply_to = 67; // Message-Raw-Header:In-Reply-To
  optional string raw_header_return_path = 68; // Message-Raw-Header:Return-Path
  optional string raw_header_received = 69;    // Message-Raw-Header:Received
  optional string raw_header_x_mailer = 70;    // Message-Raw-Header:X-Mailer
  optional string raw_header_user_agent = 71;  // Message-Raw-Header:User-Agent
  optional string raw_header_x_originating_ip = 72; // Message-Raw-Header:X-Originating-IP
  optional string raw_header_content_type = 73; // Message-Raw-Header:Content-Type
  optional string raw_header_content_encoding = 74; // Message-Raw-Header:Content-Encoding
  optional string raw_header_mime_version = 75; // Message-Raw-Header:MIME-Version
  
  // === Content and Body Properties ===
  optional string content_type = 76;           // Metadata.CONTENT_TYPE
  optional string content_encoding = 77;       // Content encoding
  optional string charset = 78;                // Character set
  optional bool has_attachments = 79;          // Whether email has attachments
  optional int32 attachment_count = 80;        // Number of attachments
  
  // === Security and Encryption Properties ===
  optional bool has_signature = 81;            // TikaCoreProperties.HAS_SIGNATURE
  optional bool is_encrypted = 82;             // TikaCoreProperties.IS_ENCRYPTED
  repeated string signature_name = 83;         // TikaCoreProperties.SIGNATURE_NAME
  repeated google.protobuf.Timestamp signature_date = 84; // TikaCoreProperties.SIGNATURE_DATE
  repeated string signature_location = 85;     // TikaCoreProperties.SIGNATURE_LOCATION
  repeated string signature_reason = 86;       // TikaCoreProperties.SIGNATURE_REASON
  repeated string signature_filter = 87;       // TikaCoreProperties.SIGNATURE_FILTER
  repeated string signature_contact_info = 88; // TikaCoreProperties.SIGNATURE_CONTACT_INFO
  
  // === Threading and Conversation Properties ===
  optional string thread_topic = 89;           // Thread topic (normalized)
  optional string thread_index = 90;           // Thread index for conversation tracking
  optional int32 thread_depth = 91;            // Depth in conversation thread
  
  // === Delivery and Routing Properties ===
  optional string delivery_receipt_requested = 92; // Delivery receipt flag
  optional string read_receipt_requested = 93;     // Read receipt flag
  optional string auto_forwarded = 94;             // Auto-forwarded flag
  optional string sensitivity = 95;                // Message sensitivity level
  optional string x400_content_type = 96;          // X.400 content type
  optional string transport_message_headers = 97;  // Transport headers
  
  // === Size and Technical Properties ===
  optional int64 message_size = 98;            // Message size in bytes
  optional int32 line_count = 99;              // Number of lines in message
  optional string encoding_detector = 100;     // TikaCoreProperties.ENCODING_DETECTOR
  optional string detected_encoding = 101;     // TikaCoreProperties.DETECTED_ENCODING
  
  // === Parsing Metadata ===
  repeated string parsed_by = 102;             // TikaCoreProperties.TIKA_PARSED_BY
  optional string detected_language = 103;     // TikaCoreProperties.TIKA_DETECTED_LANGUAGE
  optional double detected_language_confidence = 104; // TikaCoreProperties.TIKA_DETECTED_LANGUAGE_CONFIDENCE
  
  // === Embedded Resource Properties ===
  optional string embedded_resource_type = 105; // TikaCoreProperties.EMBEDDED_RESOURCE_TYPE
  optional string resource_name = 106;         // TikaCoreProperties.RESOURCE_NAME_KEY
  optional string original_resource_name = 107; // TikaCoreProperties.ORIGINAL_RESOURCE_NAME
  
  // === Catch-all for unknown/unmapped fields ===
  google.protobuf.Struct additional_metadata = 200;
  
  /**
   * Base Tika fields common to all document types
   */
  io.pipeline.parsed.data.tika.base.v1.TikaBaseFields base_fields = 201;
}
